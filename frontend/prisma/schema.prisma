// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  channels  Channel[]
}

model Channel {
  id             String    @id @default(cuid())
  channelId       String    @unique
  userId          String
  title           String?
  description     String?
  customUrl       String?
  thumbnailUrl    String?
  subscriberCount Int       @default(0)
  videoCount      Int       @default(0)
  viewCount       BigInt    @default(0)
  fingerprint     Json?
  nicheKeywords   String[]
  lastAnalyzed    DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  user            User      @relation(fields: [userId], references: [id])
  trends          ChannelTrend[]
}

model TrendSnapshot {
  id             String        @id @default(cuid())
  keyword        String
  searchVolume   Int           @default(0)
  growthRate     Float         @default(0)
  competition    Int           @default(0)
  trendScore     Float         @default(0)
  geo            String        @default("US")
  category       String?
  relatedKeywords String[]
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  channelTrends  ChannelTrend[]
}

model ChannelTrend {
  id                String        @id @default(cuid())
  channelId         String
  trendId           String
  matchScore        Float
  reasoning         String?
  contentAngle      String?
  recommendationData Json?         // Store full recommendation data
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  channel           Channel       @relation(fields: [channelId], references: [channelId])
  trend             TrendSnapshot @relation(fields: [trendId], references: [id])

  @@unique([channelId, trendId])
  @@index([channelId])
  @@index([trendId])
}
